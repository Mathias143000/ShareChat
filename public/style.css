:root{
  --bg:#f9fafb; --card:#fff; --text:#111827; --muted:#6b7280;
  --border:rgba(0,0,0,.12);
  --hover-bg:rgba(0,0,0,.03); --hover-border:rgba(0,0,0,.18);
  --radius:16px; --danger:#dc2626;
  --btn-h:42px; --input-h:44px;
}
[data-theme="dark"]{
  --bg:#0b1220; --card:#0f172a; --text:#e5e7eb; --muted:#9aa4b2; --border:#334155;
  --hover-bg:rgba(255,255,255,.03); --hover-border:#475569;
  --danger:#ef4444;
}

/* base */
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}

/* header */
.header{display:flex;align-items:center;justify-content:space-between;padding:16px 20px 14px}
.brand h1{margin:0 0 4px;font-size:28px}
.subtitle{color:var(--muted);font-size:14px}
.header-actions{display:flex;gap:8px}
h2{font-size:22px}

/* layout */
.container{
  display:grid;grid-template-columns:1fr 1fr;grid-template-rows:1fr;
  gap:16px;height:calc(100vh - 96px);padding:0 20px 8px;overflow:hidden
}
@media (max-width:960px){
  .container{grid-template-columns:1fr;grid-template-rows:auto;height:auto;overflow:visible}
}
.card{
  background:var(--card);border:1px solid var(--border);border-radius:var(--radius);
  padding:16px;display:flex;flex-direction:column;min-height:0
}
.card>h2{display:flex;align-items:center;justify-content:space-between;margin:0 0 8px}
.muted{color:var(--muted)}
.status{margin:6px 0 10px;min-height:18px}

/* buttons */
.btn,.btn:link,.btn:visited{
  display:inline-flex;align-items:center;justify-content:center;
  height:var(--btn-h);padding:0 14px;border:1px solid var(--border);background:var(--card);
  color:var(--text);border-radius:10px;text-decoration:none;font-weight:600;font-size:14px;cursor:pointer;
  transition:background .12s,border-color .12s,transform .05s,box-shadow .12s;
}
.btn:hover{background:var(--hover-bg)}
.btn:active{transform:scale(.99)}
.btn:focus-visible{outline:0;box-shadow:0 0 0 3px rgba(59,130,246,.35)}
.btn.del:hover{background:rgba(220,38,38,.06);border-color:rgba(220,38,38,.35);color:#b91c1c}

/* theme button */
#themeToggle{
  height:40px;padding:0 12px;border:1px solid var(--border);background:var(--card);color:var(--text);
  border-radius:10px;display:inline-flex;align-items:center;justify-content:center;gap:8px;
  font-size:14px;line-height:1;cursor:pointer;user-select:none;
  transition:background .12s,border-color .12s,transform .05s,box-shadow .12s;
}
#themeToggle .icon{font-size:20px;line-height:1}
#themeToggle:hover{background:var(--hover-bg);border-color:var(--hover-border)}
#themeToggle:active{transform:scale(.99)}
#themeToggle:focus-visible{outline:0;box-shadow:0 0 0 3px rgba(59,130,246,.35)}

/* dropzone — теперь курсив */
.dropzone{
  border:2px dashed var(--border);border-radius:12px;min-height:220px;padding:28px;text-align:center;margin-bottom:12px;
  display:flex;align-items:center;justify-content:center;flex-direction:column;gap:6px;
  background:transparent;cursor:pointer;transition:background .12s,border-color .12s,transform .05s;
  font-style:italic; font-weight:400;
}
.dropzone:hover{background:var(--hover-bg)}
.dropzone.dragover{border-color:#999}
.dropzone:active{transform:scale(.996)}

/* files */
.file-list{display:grid;gap:10px;flex:1;min-height:0;overflow:auto;align-content:start;padding-bottom:8px}
.file{
  display:grid;grid-template-columns:1fr auto;gap:8px;align-items:center;
  border:1px solid var(--border);border-radius:12px;padding:10px;background:var(--card)
}
.file .name{font-weight:600}
.file .meta{color:var(--muted);font-size:13px}
.file .actions{display:flex;gap:8px;align-items:center}
/* кнопка удаления всегда видима */
.file .btn.del{
  opacity:1 !important;
  min-width:var(--btn-h);
  padding:0 10px;
  display:inline-flex;
}
.file:hover .btn.del{opacity:1 !important}

/* chat box + messages */
.chat-box{
  border:1px solid var(--border);border-radius:12px;flex:1;min-height:220px;overflow:auto;background:var(--card);
  margin-bottom:12px;padding:8px
}
.msg{
  border:1px solid var(--border);border-radius:10px;padding:10px;background:var(--card);
  white-space:pre-wrap;margin-bottom:8px;cursor:pointer;transition:background .12s,border-color .12s
}
.msg .head{color:var(--muted);font-size:12px;margin-bottom:6px}
.msg:hover{background:var(--hover-bg);border-color:var(--hover-border)}
@keyframes msgPulse{0%{box-shadow:0 0 0 0 rgba(0,0,0,.0)}50%{box-shadow:0 0 0 3px rgba(0,0,0,.12)}100%{box-shadow:0 0 0 0 rgba(0,0,0,.0)}}
.msg.copied{animation:msgPulse .6s ease}
/* подсветка @Никнейм: */
.msg .mention{color:#2563eb;background:rgba(37,99,235,.10);border-radius:6px;padding:0 .25em}

/* chat form */
#chatForm{
  display:grid;grid-template-columns:160px 1fr;grid-template-areas:"name msg" "send send";
  gap:8px;align-items:end;position:relative
}

/* inputs + textarea */
.name-input{
  height:var(--input-h);min-height:var(--input-h);
  padding:10px;border:1px solid var(--border);border-radius:8px;
  font:inherit;background:var(--card);color:var(--text);
  transition:background .12s,border-color .12s,box-shadow .12s;
}
.message-input{
  min-height:var(--input-h);
  height:auto;                         /* для авто-роста */
  padding:10px;border:1px solid var(--border);border-radius:8px;
  font:inherit;background:var(--card);color:var(--text);
  line-height:1.35;
  resize:none;                         /* управляем ростом кодом */
  overflow-y:auto;                     /* появится скролл на пределе */
  max-height:220px;                    /* лимит роста */
  transition:background .12s,border-color .12s,box-shadow .12s,height .12s;
}
.name-input:not(:focus):hover,.message-input:not(:focus):hover{background:var(--hover-bg);border-color:var(--hover-border)}
.name-input:focus-visible,.message-input:focus-visible{outline:0;box-shadow:0 0 0 3px rgba(59,130,246,.35)}
.message-input.has-mention{box-shadow:0 0 0 3px rgba(59,130,246,.35) inset}

/* mentions menu */
.mention-menu{
  position:absolute;left:170px;right:0;bottom:60px;max-height:220px;overflow:auto;
  border:1px solid var(--border);background:var(--card);border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.12);padding:6px;z-index:2
}
.mention-item{padding:8px;border-radius:8px;cursor:pointer}
.mention-item:hover,.mention-item.active{background:var(--hover-bg)}

/* chat header controls */
.chat-controls,.chat-actions{display:flex;align-items:center;gap:8px}
.chat-controls .label{font-weight:700;font-size:20px}

/* compact selector (~на треть короче) */
.chat-controls .select,.chat-actions .select{
  height:var(--btn-h);border:1px solid var(--border);background:var(--card);color:var(--text);
  border-radius:10px;padding:0 6px;min-width:40px;font-size:14px;line-height:1;cursor:pointer;
}
.chat-controls .select[size]:not([size="1"]),
.chat-actions  .select[size]:not([size="1"]){
  max-height:180px;overflow:auto
}

/* +/- buttons */
.chat-controls .icon-btn,.chat-actions .icon-btn{
  width:40px;height:40px;display:inline-flex;align-items:center;justify-content:center;
  border:1px solid var(--border);background:var(--card);color:var(--text);
  border-radius:10px;font-size:18px;line-height:1;cursor:pointer;
  transition:background .12s,border-color .12s,transform .05s;
}
.chat-controls .icon-btn:hover,.chat-actions .icon-btn:hover{background:var(--hover-bg);border-color:var(--hover-border)}
.chat-controls .icon-btn:active,.chat-actions .icon-btn:active{transform:scale(.99)}

.footer{padding:8px 20px;min-height:0}

/* accessibility */
@media (prefers-reduced-motion: reduce){
  *{animation:none !important;transition:none !important}
}
